# Backstop Sitemap

Just a helper for generating backstopjs config based on links in a page (also with login functionality).

## How to use

1. Clone this repo;
2. Edit config.js with your relevant website data;
3. Edit `template/backstop.json` and `template/cookies.json` with your custom configuration;
4. run `npm i && npm start`;

## How it works

This is a simple script that will connect to a website, look for `<a>` tags based on a given selector and generate a `backstop.json` config file from a template. This json will have scenarios for each url found:

* `label` will be the textual content of `<a>` or the `href` in case it's empty and
* `url` will be the `href` resolved with base url from `config.js`.

If `loginUri` exists it'll record and merge all cookie information with `template/cookies.json` and output it to `cookies.json` so backstop can use it.

## config.js

This was made with AEM in mind, but it might work with other websites, considering that login cookies is usually generated by a authentication service.

* `linkSelector` - cheerio selector to get links from sitemapUri page;
* `url` - base url to connect;
* `loginUri` - where you need to post your user / password data (relative to url);
* `loginPostData` - what needs to be posted to your loginUri;
* `sitemapUri` - where is the "sitemap" (or you can point it to `/` and get links from your main navigation, for example).

## template/backstop.json

This is a base backstop.json file that will be used to generate your final file when using `npm start`.

Note that `baseScenario` is a custom property that will be used to build all scenarios.

If you create a scenario with a label that will be generated by the "sitemap", it'll be merged in generated `backstop.json` file.
